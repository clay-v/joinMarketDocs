(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{403:function(e,t,n){"use strict";n.r(t);var a=n(40),o=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h3",{attrs:{id:"test-instructions-for-developers"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#test-instructions-for-developers"}},[e._v("#")]),e._v(" Test instructions (for developers):")]),e._v(" "),n("p",[e._v("Work in your "),n("code",[e._v("jmvenv")]),e._v(" virtualenv as for all Joinmarket work. Make sure to have "),n("a",{attrs:{href:"https://bitcoin.org/en/full-node",target:"_blank",rel:"noopener noreferrer"}},[e._v("bitcoind"),n("OutboundLink")],1),e._v(" 0.18 or newer installed. Also need miniircd installed to the root (i.e. in your "),n("code",[e._v("joinmarket-clientserver")]),e._v(" directory):")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("(jmvenv)$ cd /path/to/joinmarket-clientserver\n(jmvenv)$ git clone https://github.com/Joinmarket-Org/miniircd\n")])])]),n("p",[e._v("Install the test requirements:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("(jmvenv)$ pip install -r requirements/testing.txt\n")])])]),n("h4",{attrs:{id:"running-the-test-suite"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#running-the-test-suite"}},[e._v("#")]),e._v(" Running the test suite.")]),e._v(" "),n("p",[e._v("Have a "),n("code",[e._v("bitcoin.conf")]),e._v(" ready in some location, whose contents only need to be:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("rpcuser=bitcoinrpc\nrpcpassword=123456abcdef\nfallbackfee=0.0002\n")])])]),n("p",[e._v("(any random password is fine of course). It is also advisable to wipe ~/.bitcoin/regtest first, in case it gets large and slow to process.")]),e._v(" "),n("p",[e._v("Then copy the "),n("code",[e._v("regtest_joinmarket.cfg")]),e._v(" file from the "),n("code",[e._v("test/")]),e._v(" directory to the "),n("code",[e._v("joinmarket-clientserver/")]),e._v(" directory and rename it to "),n("code",[e._v("joinmarket.cfg")]),e._v("; you probably won't need to change anything in the file except perhaps the above password, and the "),n("code",[e._v("native")]),e._v(" setting if you're doing bech32 wallet tests.")]),e._v(" "),n("p",[e._v("Run the test suite via pytest:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("(jmvenv)$ pytest --btcconf=/path/to/bitcoin.conf --btcroot=/path/to/bitcoin/bin/ --btcpwd=123456abcdef --nirc=2 --ignore test/test_full_coinjoin.py -p no:warnings\n")])])]),n("h4",{attrs:{id:"running-tests-of-sendpayment-and-tumbler-including-with-malicious-makers"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#running-tests-of-sendpayment-and-tumbler-including-with-malicious-makers"}},[e._v("#")]),e._v(" Running tests of sendpayment and tumbler (including with malicious makers)")]),e._v(" "),n("p",[e._v("The file "),n("code",[e._v("test/ygrunner.py")]),e._v(" provides the ability to spin up a set of yieldgenerator\nbots against the local IRC instance with the local regtest blockchain. It can be\nstarted with")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("(jmvenv)$ pytest --btcconf=/path/to/bitcoin.conf --btcroot=/path/to/bitcoin/bin/ --btcpwd=123456abcdef --nirc=2 test/ygrunner.py -s\n")])])]),n("p",[e._v("Here the "),n("code",[e._v("-s")]),e._v(" flag is necessary because it prints log output to the console. If you\nkeep the logging level at the default "),n("code",[e._v("INFO")]),e._v(" only a minimum amount will come out, if\nyou want more then enter this into the "),n("code",[e._v("joinmarket.cfg")]),e._v(" in the "),n("code",[e._v("joinmarket-clientserver/")]),e._v(" directory:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("[LOGGING]\nconsole_log_level = DEBUG\n")])])]),n("p",[e._v("It will print out a hex seed for a wallet you can use for tumble/sendpayment (just set the walletname to that hex value).\nNext, go into the "),n("code",[e._v("scripts/")]),e._v(" directory and make sure you have copied the "),n("code",[e._v("joinmarket.cfg")]),e._v(" (from "),n("code",[e._v("test/regtest_joinmarket.cfg")]),e._v(", as above)\nfile into that directory also, make any changes needed (like the LOGGING one above),\nand run either sendpayment or tumbler with whatever parameters you choose, BUT: remember to add the "),n("code",[e._v("--datadir=.")]),e._v(" argument so that your test "),n("code",[e._v("joinmarket.cfg")]),e._v(" file gets picked up, not the one in "),n("code",[e._v("~/.joinmarket")]),e._v(".")]),e._v(" "),n("p",[e._v("So for example:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("(jmvenv)$ python sendpayment.py -N2 -m1 5c88acf2546bd7b083b9cfb2e0af7f2d --datadir=. 30000000 2Address\n")])])]),n("p",[e._v("To change the parameters of the yieldgenerators you can edit the parametrization of\nthe function "),n("code",[e._v("test_start_ygs")]),e._v(" in "),n("a",{attrs:{href:"https://github.com/Joinmarket-Org/joinmarket-clientserver/blob/master/test/ygrunner.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("this file"),n("OutboundLink")],1),e._v(".")]),e._v(" "),n("p",[e._v("There are two changes that may be of special interest:")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("to change the number of yg\nbots from e.g. 3 to 4, edit the first number in the parameter list entry to 3 and the\nthird entry to 4 (4 means three ygs plus one taker bot).")])]),e._v(" "),n("li",[n("p",[e._v("More advanced case: To make the yg bots selectively (randomly) malicious, edit the last entry from 0 to some non-zero\ninteger representing a percentage chance of rejection, both at the receive-auth\nstage and the receive-tx stage. So if you set this to 20, it means there will be\na 20% chance of "),n("em",[e._v("each")]),e._v(" yg bot rejecting the auth message and the tx message (both\n20%). If you are running tumbler in adversarial conditions like that, consider\nchanging things like the taker_utxo_retries or adding external commitments with\nthe add-utxo tool so external commitments usage can be tested.")])])]),e._v(" "),n("h3",{attrs:{id:"testing-joinmarket-qt-with-regtest"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#testing-joinmarket-qt-with-regtest"}},[e._v("#")]),e._v(" Testing Joinmarket-Qt with regtest")]),e._v(" "),n("p",[e._v("You can follow the process above using "),n("code",[e._v("test/ygrunner.py")]),e._v(" to set up the environment, and then just run:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("(jmvenv)$ python joinmarket-qt.py --datadir=.\n")])])]),n("p",[e._v("When loading a wallet here, regtest will be detected and will request a hex seed as described above.")]),e._v(" "),n("p",[e._v("The 'generate' and 'recover' functions will not work like this on regtest, but you can generate a file-based wallet on regtest from the command line,\nand then load it with a one line hack to the joinmarket-qt.py file (I'll let you work that out, if you got this far ðŸ˜ƒ ).\nYou can also do full tumbler tests, on regtest, using the GUI, using this setup. Spin up ygrunner.py as described above, then start the tumbler wizard\nin the 'CoinJoin' tab, and the multi- subtab, and choose Generate Tumbler Schedule. There are 3 default destination addresses provided although\nyou may want to change them, depending on the test.")])])}),[],!1,null,null,null);t.default=o.exports}}]);