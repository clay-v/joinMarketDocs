(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{395:function(e,t,a){"use strict";a.r(t);var n=a(40),o=Object(n.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h3",{attrs:{id:"payjoin-aka-p2ep-user-guide"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#payjoin-aka-p2ep-user-guide"}},[e._v("#")]),e._v(" PayJoin (aka P2EP) user guide.")]),e._v(" "),a("p",[e._v("(You've installed using the "),a("code",[e._v("install.sh")]),e._v(" or similar as per instructions in the README before\nreading this).")]),e._v(" "),a("p",[e._v("This document does "),a("strong",[e._v("not")]),e._v(" discuss why PayJoin is interesting or the general concept.\nFor that, see "),a("a",{attrs:{href:"https://joinmarket.me/blog/blog/payjoin/",target:"_blank",rel:"noopener noreferrer"}},[e._v("this"),a("OutboundLink")],1),e._v(" post.")]),e._v(" "),a("h3",{attrs:{id:"contents"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#contents"}},[e._v("#")]),e._v(" Contents")]),e._v(" "),a("ol",[a("li",[a("p",[a("a",{attrs:{href:"#preparatory"}},[e._v("Preparatory step: configuring for Bitcoin Core")])])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#before"}},[e._v("Before I put funds in; how do I spend them/sweep them out?")])])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#makefund"}},[e._v("Make and fund the wallet")])])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#doing"}},[e._v("Doing a PayJoin payment")])]),e._v(" "),a("p",[e._v("a. "),a("a",{attrs:{href:"#bip78"}},[e._v("Using BIP78 payjoins to pay a merchant or other user's wallet")])]),e._v(" "),a("p",[e._v("b. "),a("a",{attrs:{href:"#jmtojm"}},[e._v("Using Joinmarket-wallet-to-Joinmarket-wallet payjoins")])]),e._v(" "),a("p",[e._v("c. "),a("a",{attrs:{href:"#fees"}},[e._v("About fees")])])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#p2sh"}},[e._v("What if I wanted p2sh segwit addresses?")])])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#receiving"}},[e._v("Receiving a BIP78 Payjoin payment")])])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#torconfig"}},[e._v("Configuring Tor to setup a hidden service")])])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#using-qt"}},[e._v("Using JoinmarketQt to send and receive Payjoins")])])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#sample"}},[e._v("Sample testnet wallet display output")])])])]),e._v(" "),a("p",[e._v("Some instructions here will be redundant with the introductory "),a("RouterLink",{attrs:{to:"/users/USAGE.html"}},[e._v("usage guide")]),e._v("; sections 1-3 are aimed at users who have not/ will not use Joinmarket for ordinary coinjoins.\nSo just skip those sections if you already know it.")],1),e._v(" "),a("a",{attrs:{name:"preparatory"}}),e._v(" "),a("h3",{attrs:{id:"preparatory-step-configuring-for-bitcoin-core"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preparatory-step-configuring-for-bitcoin-core"}},[e._v("#")]),e._v(" Preparatory step: configuring for Bitcoin Core.")]),e._v(" "),a("p",[e._v("Joinmarket currently requires a Bitcoin Core full node, version 0.18 or newer, although it can be pruned.")]),e._v(" "),a("p",[e._v("First thing to do: in "),a("code",[e._v("scripts/")]),e._v(", run:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("python wallet-tool.py generate\n")])])]),a("p",[e._v("This "),a("em",[e._v("should")]),e._v(" quit with an error, because the rpc is not configured. Open the newly created file "),a("code",[e._v("joinmarket.cfg")]),e._v(",\nand edit:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("[BLOCKCHAIN]\nrpc_user = yourusername-as-in-bitcoin.conf\nrpc_password = yourpassword-as-in-bitcoin.conf\nrpc_host = localhost #default usually correct \nrpc_port = 8332 # default for mainnet\n")])])]),a("p",[e._v("Note, you can also use a cookie file by setting, in this section, a variable "),a("code",[e._v("rpc_cookie_file")]),e._v(" to the location of the file,\nas an alternative to using user/password.")]),e._v(" "),a("p",[e._v("If you use Bitcoin Core's multiwallet feature, you can edit the value of "),a("code",[e._v("rpc_wallet_file")]),e._v(" to your chosen wallet file.")]),e._v(" "),a("p",[e._v("Then retry the same "),a("code",[e._v("generate")]),e._v(" command; it should now not error - continue the generate process as per steps below.")]),e._v(" "),a("p",[e._v("However, if you still get rpc connection errors, make sure you can connect to your Core node using the command line first.")]),e._v(" "),a("a",{attrs:{name:"before"}}),e._v(" "),a("h3",{attrs:{id:"before-i-put-funds-in-how-do-i-spend-them-sweep-them-out"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#before-i-put-funds-in-how-do-i-spend-them-sweep-them-out"}},[e._v("#")]),e._v(" Before I put funds in; how do I spend them/sweep them out?")]),e._v(" "),a("p",[e._v("Good question! Whichever Joinmarket wallet you set up, you can always make a normal\n(non-coinjoin, non-PayJoin, nothing clever - just a normal payment) using the syntax:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("python sendpayment.py -N0 -m <mixdepth> mywalletname.jmdat amount address\n")])])]),a("p",[e._v('Amount can be specified as both bitcoins (if decimal value or has "btc" suffix) or satoshis (if integer value or has "sat" suffix). So, 0.1 BTC can be specified as 0.1, 0.1btc, 10000000 or 10000000sat.\nAlso very important: to empty an account or '),a("em",[e._v("mixdepth")]),e._v(" (more on this below),\nset the amount to 0. You will be prompted with the destination and amount before actually pushing the transaction\nto the network, as a sanity check. It looks like this:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("2019-01-19 18:20:08,509 [INFO]  Using a fee of : 0.00001672 BTC (1672 sat).\n2019-01-19 18:20:08,510 [INFO]  Using a change value of: 1.89998328 BTC (189998328 sat).\n2019-01-19 18:20:08,511 [INFO]  Got signed transaction:\n\n2019-01-19 18:20:08,511 [INFO]  {'ins': [{'outpoint': {'hash': '0a00b5a40f4cd587b3158fbf37c75e1824df25b8c8a59e3760a6d3e4850e70e3',\n                       'index': 0},\n          'script': '1600146cac63b385d6e45acce4d814d9a5d4c36d7515a8',\n          'sequence': 4294967295,\n          'txinwitness': ['3045022100d9fe2096c689e882c560c3d5b7adf633b252c2ff8fed3fd81dd5523556ff404302204efdcc947899c7f330a321d5a7a4b56aec457ec5d6dfce72c93351bc65d1cb6c01',\n                          '03f58d6a2f317f829b3bf21a3ba79887013597853e45d656e43222930c5a2854f1']}],\n 'locktime': 0,\n 'outs': [{'script': 'a9140b48ac588e74b7dc02755459dbd56ef39a55f06687',\n           'value': 10000000},\n          {'script': 'a91477967d4582ef80417943dc152ab36858de02dedf87',\n           'value': 189998328}],\n 'version': 1}\n2019-01-19 18:20:08,511 [INFO]  In serialized form (for copy-paste):\n2019-01-19 18:20:08,511 [INFO]  01000000000101e3700e85e4d3a660379ea5c8b825df24185ec737bf8f15b387d54c0fa4b5000a00000000171600146cac63b385d6e45acce4d814d9a5d4c36d7515a8ffffffff02809698000000000017a9140b48ac588e74b7dc02755459dbd56ef39a55f06687f824530b0000000017a91477967d4582ef80417943dc152ab36858de02dedf8702483045022100d9fe2096c689e882c560c3d5b7adf633b252c2ff8fed3fd81dd5523556ff404302204efdcc947899c7f330a321d5a7a4b56aec457ec5d6dfce72c93351bc65d1cb6c012103f58d6a2f317f829b3bf21a3ba79887013597853e45d656e43222930c5a2854f100000000\n2019-01-19 18:20:08,512 [INFO]  Sends: 0.10000000 BTC (10000000 sat) to address: 2MtGtUpRFVYcQSYgjr6XDHo9QKhjsb3GRye\nWould you like to push to the network? (y/n):\n")])])]),a("p",[e._v("This means that if you only want to do PayJoins and normal payments, and never coinjoins,\nyou can do so and just use the above to move funds out of the wallet when it's time.")]),e._v(" "),a("p",[e._v("(Extra note: you can also use the "),a("code",[e._v("-p")]),e._v(" option to "),a("code",[e._v("wallet-tool.py")]),e._v(" (see the help for that script)\nto get private keys if that's ever needed (never do this except in emergency cases). You can also\nuse the mnemonic phrase in some other wallets, e.g. Electrum.)")]),e._v(" "),a("p",[e._v("So now we know that, let's continue doing the "),a("code",[e._v("generate")]),e._v(" command to make a new wallet ... :")]),e._v(" "),a("a",{attrs:{name:"makefund"}}),e._v(" "),a("h3",{attrs:{id:"make-and-fund-the-wallet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#make-and-fund-the-wallet"}},[e._v("#")]),e._v(" Make and fund the wallet")]),e._v(" "),a("p",[e._v("Continue/complete the wallet generation with the above ("),a("code",[e._v("generate")]),e._v(") method.")]),e._v(" "),a("p",[e._v("(But wait again! Before you finish: want a p2sh segwit wallet? you probably don't,\nbut read "),a("a",{attrs:{href:"#what-if-i-wanted-p2sh-segwit-addresses"}},[e._v("this")]),e._v(" if you do.)")]),e._v(" "),a("p",[e._v("The wallet you create is (if not p2sh) BIP84 by default, using BIP39 12 word seed,\nmnemonic extension optional (simplest to leave it out if you're not sure).")]),e._v(" "),a("p",[e._v("Once the "),a("code",[e._v("generate")]),e._v(" method run has completed, successfully, you need to look at the wallet contents. Use\nthe "),a("code",[e._v("display")]),e._v(" method which is the default:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("python wallet-tool.py wallet-name-you-chose.dat [display]\n")])])]),a("p",[e._v('("display" is optional because default; use '),a("code",[e._v("python wallet-tool.py -h")]),e._v(" to see all possible methods).")]),e._v(" "),a("p",[e._v("Below is "),a("a",{attrs:{href:"#sample"}},[e._v("an example")]),e._v(" of what the wallet looks like.")]),e._v(" "),a("p",[e._v("Joinmarket by default uses "),a("em",[e._v("5")]),e._v(" accounts, not only 1 as some other wallets (e.g. Electrum), this is to help\nwith coin isolation. Try to move coins from one account to another "),a("em",[e._v("only")]),e._v(" via coinjoins; or, you can just\nuse one or two accounts (called "),a("strong",[e._v("mixdepths")]),e._v(" in Joinmarket parlance) as if they were just one, understanding\nthat if you don't bother to do anything special, the coins in those two mixdepths are linked.")]),e._v(" "),a("p",[a("strong",[e._v("Fund")]),e._v(" the wallet by choosing one or more addresses in the "),a("em",[e._v("external")]),e._v(' section of the first account (called\n"Mixdepth 0" here). When you fund, fund to the external addresses. The internals will be used for change.')]),e._v(" "),a("p",[e._v("(The new standard (BIP84) "),a("em",[e._v("should")]),e._v(" be compatible with TREZOR, Ledger, Electrum, Samourai and some others,\nincluding the 12 word seed, although consider privacy concerns when sending addresses to remote servers!).")]),e._v(" "),a("a",{attrs:{name:"doing"}}),e._v(" "),a("h3",{attrs:{id:"doing-a-payjoin-payment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#doing-a-payjoin-payment"}},[e._v("#")]),e._v(" Doing a PayJoin payment.")]),e._v(" "),a("p",[e._v("This section gives details on how to make payments with Payjoin. You might prefer to start with the video linked "),a("a",{attrs:{href:"#using-qt"}},[e._v("here")]),e._v(" to see how this works if you are using JoinmarketQt rather than the command line.")]),e._v(" "),a("a",{attrs:{name:"bip78"}}),e._v(" "),a("h4",{attrs:{id:"using-bip78-payjoins-to-pay-a-merchant"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-bip78-payjoins-to-pay-a-merchant"}},[e._v("#")]),e._v(" Using BIP78 payjoins to pay a merchant.")]),e._v(" "),a("p",[e._v("The process here is to use the syntax of sendpayment.py:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('(jmvenv)a$ python sendpayment.py -m 0 walletname.jmdat "bitcoin:bc1qxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx?amount=0.05933201&pj=https://some/url/payjoin"\n')])])]),a("p",[e._v("Notes on this:")]),e._v(" "),a("ul",[a("li",[e._v("Payjoins BIP78 style are done using the "),a("code",[e._v("sendpayment")]),e._v(' script, or by entering the BIP21 URI into the "Recipient" field in JoinmarketQt.')]),e._v(" "),a("li",[e._v("They are done using BIP21 URIs. These can be copy/pasted from a website (e.g. a btcpayserver invoice page), note that double quotes are required (on the command line) because the string contains special characters. Note also that you must see "),a("code",[e._v("pj=")]),e._v(" in the URI, otherwise payjoin is not supported by that server.")]),e._v(" "),a("li",[e._v("If the url in "),a("code",[e._v("pj=")]),e._v(" is "),a("code",[e._v("****.onion")]),e._v(" it means you must be using Tor, remember to have Tor running on your system and change the configuration (see below) for socks5 port if necessary. If you are running the Tor browser the port is 9150 instead of 9050.")]),e._v(" "),a("li",[e._v("Don't forget to specify the mixdepth you are spending from with "),a("code",[e._v("-m 0")]),e._v(". The payment amount is of course in the URI, along with the address.")]),e._v(" "),a("li",[e._v("Pay attention to address type; this point is complicated, but: some servers will not be able to match the address type of the sender, and so won't be able to construct sensible Payjoin transactions. In that case they may fallback to the non-Payjoin payment (which is not a disaster). If you want to do a Payjoin with a server that only supports p2sh, not bech32, you will have to create a new Joinmarket wallet, specifying "),a("code",[e._v("native=false")]),e._v(" in the "),a("code",[e._v("POLICY")]),e._v(" section of "),a("code",[e._v("joinmarket.cfg")]),e._v(" before you generate the wallet.")])]),e._v(" "),a("p",[e._v("Before you do such coinjoins, you may want to:")]),e._v(" "),a("ul",[a("li",[e._v("regenerate "),a("code",[e._v("joinmarket.cfg")]),e._v(". First, rename your current "),a("code",[e._v("joinmarket.cfg")]),e._v(" (in "),a("code",[e._v("~/.joinmarket")]),e._v(" on Linux), then run a script once to have it regenerated from defaults. Then reapply your custom changes.")]),e._v(" "),a("li",[e._v("once you have done this, you will see a new section:")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[PAYJOIN]\n# for the majority of situations, the defaults\n# need not be altered - they will ensure you don't pay\n# a significantly higher fee.\n# MODIFICATION OF THESE SETTINGS IS DISADVISED.\n\n# Payjoin protocol version; currently only '1' is supported.\npayjoin_version = 1\n\n# servers can change their destination address by default (0).\n# if '1', they cannot. Note that servers can explicitly request\n# that this is activated, in which case we respect that choice.\ndisable_output_substitution = 0\n\n# \"default\" here indicates that we will allow the receiver to\n# increase the fee we pay by:\n# 1.2 * (our_fee_rate_per_vbyte * vsize_of_our_input_type)\n# (see https://github.com/bitcoin/bips/blob/master/bip-0078.mediawiki#span_idfeeoutputspanFee_output)\n# (and 1.2 to give breathing room)\n# which indicates we are allowing roughly one extra input's fee.\n# If it is instead set to an integer, then that many satoshis are allowed.\n# Additionally, note that we will also set the parameter additionafeeoutputindex\n# to that of our change output, unless there is none in which case this is disabled.\nmax_additional_fee_contribution = default\n\n# this is the minimum satoshis per vbyte we allow in the payjoin\n# transaction; note it is decimal, not integer.\nmin_fee_rate = 1.1\n\n# for payjoin onion service creation, the tor control configuration:\ntor_control_host = localhost\n# or, to use a UNIX socket\n# control_host = unix:/var/run/tor/control\ntor_control_port = 9051\n\n# for payjoins to hidden service endpoints, the socks5 configuration:\nonion_socks5_host = localhost\nonion_socks5_port = 9050\n# in some exceptional case the HS may be SSL configured,\n# this feature is not yet implemented in code, but here for the\n# future:\nhidden_service_ssl = false\n")])])]),a("p",[e._v("As the notes mention, you should probably find the defaults here are absolutely fine, and\nmodifying them probably isn't needed. But read the comments for what they are; the main point\nis that you as a payer have control over how much additional fee you are prepared to pay to allow\nthe server to participate in a Payjoin transaction with you. By default we only allow them to\nbump the fee enough to add one input to the transaction, and this should be fine in almost all cases.")]),e._v(" "),a("a",{attrs:{name:"jmtojm"}}),e._v(" "),a("h4",{attrs:{id:"using-joinmarket-wallet-to-joinmarket-wallet-payjoins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-joinmarket-wallet-to-joinmarket-wallet-payjoins"}},[e._v("#")]),e._v(" Using Joinmarket-wallet-to-Joinmarket-wallet payjoins")]),e._v(" "),a("p",[e._v("This is now deprecated; if you still want to use it, use Joinmarket(-clientserver) version 0.7.0 or lower, and see the corresponding older version of this document.")]),e._v(" "),a("a",{attrs:{name:"fees"}}),e._v(" "),a("h4",{attrs:{id:"about-fees"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#about-fees"}},[e._v("#")]),e._v(" About fees")]),e._v(" "),a("p",[e._v("In the joinmarket.cfg file, under "),a("code",[e._v("[POLICY]")]),e._v(" section you should see a setting called "),a("code",[e._v("tx_fees")]),e._v(".\nYou can set this to any integer; if you set it to 1000 or less then it's treated as a \"confirmation in N blocks target\",\ni.e. if you set it to 3 (the default), the fee is chosen from Bitcoin Core's estimator to target confirmation in 3 blocks.\nSo if you change it to e.g. 10, it will be cheaper but projected to get its first confirmation in 10 blocks on average.")]),e._v(" "),a("p",[e._v("If you set it to a number > 1000, though, it's a number of satoshis per kilobyte (technically, kilo-vbyte) that you want\nto use. "),a("strong",[e._v("Don't use less than about 1200 if you do this")]),e._v(" - a typical figure might be 5000 or 10000, corresponding to\nabout 5-10 sats/byte, which nowadays is a reasonable fee. The exact amount is randomised by ~20% to avoid you inadvertently\nwatermarking all your transactions. So don't use < 1200 because then you might be using less than 1 sat/byte which is\ndifficult to relay on the Bitcoin network.")]),e._v(" "),a("p",[e._v("BIP78 itself has various controls around fees - essentially it tries to let the receiver bump the fee but "),a("em",[e._v("only slightly")]),e._v(" to account for the fact that the receiver is adding at least one more input and so increasing the size of the transaction, and also ensure that low fees do not accidentally fall too low (even, below the relay limit). Joinmarket's receiver will only add one input and never more, for now, and it looks like this is the tradeoff that most wallets will make. If you want to learn more investigate the "),a("code",[e._v("maxadditionalfeecontribution")]),e._v(", "),a("code",[e._v("additionalfeeoutputindex")]),e._v(" and "),a("code",[e._v("minfeerate")]),e._v(" parameters described in the BIP.")]),e._v(" "),a("p",[e._v("As a spender in the BIP78 protocol, you will usually see the following: a small reduction in the size of your change output as a result of the extra 1 input. Unless the payment is very small, this probably won't be significant.")]),e._v(" "),a("a",{attrs:{name:"p2sh"}}),e._v(" "),a("h4",{attrs:{id:"what-if-i-wanted-p2sh-segwit-addresses"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-if-i-wanted-p2sh-segwit-addresses"}},[e._v("#")]),e._v(" What if I wanted p2sh segwit addresses?")]),e._v(" "),a("p",[e._v("You can do this, but bear in mind: PayJoin only gives its full effect if you and your receiver are using the same kind of addresses; so do this only if you and your receiver(s)/sender(s) agree on it - most BIP78 receivers at least for now will only engage in the protocol if they can provide inputs of the same type as yours.")]),e._v(" "),a("p",[e._v("As was noted in the BIP78 section, it may be therefore that you "),a("em",[e._v("need")]),e._v(" to do this (albeit that the worst that can happen is a fallback to non-payjoin payment, which isn't a disaster).")]),e._v(" "),a("p",[e._v("In the configuration file "),a("code",[e._v("joinmarket.cfg")]),e._v(" (which was created in the preparatory step above), go to the\nPOLICY section and set:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[POLICY]\nnative = false\n")])])]),a("p",[e._v("Note that this must be done "),a("em",[e._v("before")]),e._v(" generating the wallet, as\nthe wallet internally, of course, stores which type of addresses it manages, and it can only be of two\ntypes currently (ignoring legacy upgrades): bech32 or p2sh-segwit (starting with '3'), the former being\nthe default in Joinmarket as of 0.8.0+.")]),e._v(" "),a("p",[e._v("Note that the p2sh-wrapped-segwit style wallet is written to conform to "),a("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0040.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[e._v("BIP49"),a("OutboundLink")],1),e._v(",\nanalogous to the BIP84 case for native/bech32.")]),e._v(" "),a("a",{attrs:{name:"receiving"}}),e._v(" "),a("h4",{attrs:{id:"receiving-payments-using-bip78-payjoin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#receiving-payments-using-bip78-payjoin"}},[e._v("#")]),e._v(" Receiving payments using BIP78 Payjoin")]),e._v(" "),a("p",[e._v("Joinmarket allows you to receive payments from any wallet that supports spending via the BIP78 Protocol, using a Tor hidden service.")]),e._v(" "),a("p",[e._v('This hidden service is "ephemeral" meaning it is set up specifically for the payment and discarded after you shut down the receiving process. The setup takes some few seconds but it isn\'t too slow.')]),e._v(" "),a("p",[e._v("To make this work, you will need to do some minor configuring Tor, the first time. This is explained in detail "),a("a",{attrs:{href:"#torconfig"}},[e._v("below")]),e._v(". If you fail to do this step, you will see some rather unintelligible errors about connection failures when trying to run the script described next.")]),e._v(" "),a("p",[e._v("Once that is ready, you can run the "),a("code",[e._v("receive-payjoin.py")]),e._v(" script something like this:")]),e._v(" "),a("div",{staticClass:"language-python3 extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("(jmvenv)a$ python receive-payjoin.py -m1 walletname.jmdat 0.32\n")])])]),a("p",[e._v("The arguments provided are the wallet name and the exact amount you intend to receive (here it's 0.32 BTC (flagged as BTC because decimal), but you could also write "),a("code",[e._v("32000000")]),e._v(" which will be interpreted as satoshis).")]),e._v(" "),a("p",[e._v("After a delay of 5-50 seconds (usually; Tor setup varies unpredictably), you will see a message like this:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Your hidden service is available. Please now pass this URI string to the sender to effect the payjoin payment:\nbitcoin:bc1xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx?amount=0.32000000&pj=http://p53lf57qovyuvwsc6xnrppyply3vtqm7l6pcobkmyqsiofyeznfu5uqd.onion:7083\nKeep this process running until the payment is received.\n")])])]),a("p",[e._v("... which should be self explanatory. The sender may be using Joinmarket, or a different wallet that supports Payjoin, like Wasabi. As previously noted, Payjoins will not work if the address type in use by the two wallets is different, so for Wasabi it would be necessary to use a bech32 Joinmarket wallet (the default).")]),e._v(" "),a("p",[e._v("When the payment goes through you will see a chunk of logging text (most of which is serialized PSBTs being exchanged). If Payjoin was effected as intended, you will see:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("date string [INFO] Removed utxos= ...\ndate string [INFO] Added utxos= ...\ndate string [INFO] transaction seen on network: hex-txid\ndone\n")])])]),a("p",[e._v("where hex-txid is of course the transaction id of the payjoin transaction which paid you.")]),e._v(" "),a("p",[e._v("If you see:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("date string [INFO] Payment made without coinjoin. Transaction:\n")])])]),a("p",[e._v("followed by a detailed transaction output, it means that some incompatibility or error between the two wallets resulted in the normal non-payjoin (non-coinjoin) payment being sent; you still received your money, so DON'T ask to be paid again just because Payjoin failed! This is part of BIP78 - we recognize that things can go slightly wrong in the arrangement (for example, the wrong address type, or a fee requirement that cannot be met), so allowing normal payments instead is very much "),a("em",[e._v("intended behaviour")]),e._v(".")]),e._v(" "),a("p",[e._v("On the other hand, if you see at the end:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("2020-09-12 13:01:15,887 [WARNING]  Payment is not valid. Payment has NOT been made.\n")])])]),a("p",[e._v("it means of course the other case. Double check with your counterparty, something more fundamental has gone wrong because they did not send you a valid non-coinjoin payment, as they were supposed to right at the start.")]),e._v(" "),a("a",{attrs:{name:"torconfig"}}),e._v(" "),a("h4",{attrs:{id:"configuring-tor-to-setup-a-hidden-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuring-tor-to-setup-a-hidden-service"}},[e._v("#")]),e._v(" Configuring Tor to setup a hidden service")]),e._v(" "),a("p",[e._v("(These steps were prepared using Ubuntu; you may have to adjust for your distro).")]),e._v(" "),a("p",[e._v("First, ensure you have Tor installed:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("sudo apt install tor\n")])])]),a("p",[e._v("Don't start the tor daemon yet though, since we need to do some setup. Edit Tor's config file with sudo:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("sudo vim /etc/tor/torrc\n")])])]),a("p",[e._v("and uncomment these two lines to enable hidden service startup:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ControlPort 9051\nCookieAuthentication 1\n")])])]),a("p",[e._v("However if you proceed at this point to try to run "),a("code",[e._v("receive-payjoin.py")]),e._v(" as outlined above, you will almost certainly get an error like this:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Permission denied: '/var/run/tor/control.authcookie'\n")])])]),a("p",[e._v("... because reading this file requires being a member of the group "),a("code",[e._v("debian-tor")]),e._v(". So add your user to this group:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("sudo usermod -a -G debian-tor yourusername\n")])])]),a("p",[e._v("... and then you must "),a("em",[e._v("restart the computer/server")]),e._v(" for that change to take effect (check it with "),a("code",[e._v("groups yourusername")]),e._v(").")]),e._v(" "),a("p",[e._v("Finally, after system restart, ensure Tor is started (it may be automatically, but anyway):")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("sudo service tor start\n")])])]),a("p",[e._v("Once this is done, you should be able to run the BIP 78 receiver script, or "),a("a",{attrs:{href:"#using-qt"}},[e._v("JoinmarketQt")]),e._v(" and a hidden service will be automatically created for you from now on.")]),e._v(" "),a("a",{attrs:{name:"using-qt"}}),e._v(" "),a("h3",{attrs:{id:"using-joinmarketqt-to-send-and-receive-payjoins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-joinmarketqt-to-send-and-receive-payjoins"}},[e._v("#")]),e._v(" Using JoinmarketQt to send and receive Payjoins")]),e._v(" "),a("p",[e._v("All of the configuration details above apply to this scenario (for example, setting up Tor if you want to act as receiver.\nBut for the workflow on the GUI application, this video explains what to do:")]),e._v(" "),a("p",[e._v("https://video.autizmo.xyz/videos/watch/7081ae10-dce0-491e-9717-389ccc3aad0d")]),e._v(" "),a("a",{attrs:{name:"sample"}}),e._v(" "),a("h4",{attrs:{id:"sample-wallet-display-output"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sample-wallet-display-output"}},[e._v("#")]),e._v(" Sample wallet display output")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("JM wallet\nmixdepth\t0\txpub6CMAJ67vZWVXuzjzYXUoJgWrmuvFRiqiUG4dwoXNFmJtpTH3WgviANNxGyZYo27zxbMuqhDDym6fnBxmGaYoxr6LHgNDo1eEghkXHTX4Jnx\nexternal addresses\tm/84'/0'/0'/0\txpub6FFUn4AxdqFbnTH2fyPrkLreEkStNnMFb6R1PyAykZ4fzN3LzvkRB4VF8zWrks4WhJroMYeFbCcfeooEVM6n2YRy1EAYUvUxZe6JET6XYaW\nm/84'/0'/0'/0/0     \tbc1qt493axn3wl4gzjxvfg03vkacre0m6f2gzfhv5t\t0.00000000\tnew\nm/84'/0'/0'/0/1     \tbc1q2av9emer8k2j567yzv6ey6muqkuew4nh4rl85q\t0.00000000\tnew\nm/84'/0'/0'/0/2     \tbc1qggpg0q7cn4mpe98t29wte2rfn2rzjtn3zdmqye\t0.00000000\tnew\nm/84'/0'/0'/0/3     \tbc1qnnkqz8vcdjan7ztcpr68tyec7dw2yk8gjnr9ze\t0.00000000\tnew\nm/84'/0'/0'/0/4     \tbc1qud5s2ln88ktg83hkr6gv9s576zvt249qn2lepx\t0.00000000\tnew\nm/84'/0'/0'/0/5     \tbc1qw0lhq7xlhj7ww2jdaknv23vcyhnz6qxg23uthy\t0.00000000\tnew\nBalance:\t0.00000000\ninternal addresses\tm/84'/0'/0'/1\t\nBalance:\t0.00000000\nBalance for mixdepth 0:\t0.00000000\nmixdepth\t1\txpub6CMAJ67vZWVXyTJEaZndxZy9ACUufsmNuJwp9k5dHHKa22zQdsgALxXvMRFSwtvB8BRJzsd8h17pKqoAyHtkBrAoSqC9AUcXB1cPrSYATsZ\nexternal addresses\tm/84'/0'/1'/0\txpub6FNSLcHuGnoUbaiKgwXuKpfcbR63ybrjaqHCudrma13NDqMfKgBtZRiPZaHjSbCY3P3cgEEcdzZCwrLKXeT5jeuk8erdSmBuRgJJzfNnVjj\nm/84'/0'/1'/0/0     \tbc1qhrvm7kd9hxv3vxs8mw2arcrsl9w37a7d6ccwe4\t0.00000000\tnew\nm/84'/0'/1'/0/1     \tbc1q0sccdfrsnjtgfytul5zulst46wxgahtcf44tcw\t0.00000000\tnew\nm/84'/0'/1'/0/2     \tbc1qst6p8hr8yg280zcpvvkxahv42ecvdzq63t75su\t0.00000000\tnew\nm/84'/0'/1'/0/3     \tbc1q0gkarwg8y3nc2mcusuaw9zsn3gvzwe8mp3ac9h\t0.00000000\tnew\nm/84'/0'/1'/0/4     \tbc1qkf5wlcla2qlg5g5sym9gk6q4l4k5c98vvyj33u\t0.00000000\tnew\nm/84'/0'/1'/0/5     \tbc1qz6zptlh3cqty2tqyspjk6ksqelnvrrrvmyqa5v\t0.00000000\tnew\nBalance:\t0.00000000\ninternal addresses\tm/84'/0'/1'/1\t\nBalance:\t0.00000000\nBalance for mixdepth 1:\t0.00000000\nmixdepth\t2\txpub6CMAJ67vZWVY2cq5fmVxXw92fcgTchphGNFxweSiupYH1xYfjBiK6dj5wEEVAQeA4JcGDQGm2xcuz2UsMnDkzVmi2ESZ3xey63mQMY4x2w2\nexternal addresses\tm/84'/0'/2'/0\txpub6DqkbMG3tj2oixGYniEQTFamLCHTZx9CeAbUdBttiGuYwgfGZbrLMor8LWeJBUqTpsa81JcJqAUXuDxhXdLpKDxJAEqKMqPgJyXstj5dp3o\nm/84'/0'/2'/0/0     \tbc1qwtdgg928wma8jz32upkje7e4cegtef7yrv233l\t0.00000000\tnew\nm/84'/0'/2'/0/1     \tbc1qhkuk2gny4gumrxcaw999uq3jm3fjrjvcwz7lz3\t0.00000000\tnew\nm/84'/0'/2'/0/2     \tbc1qvu753lkltc8akfasclnq89tdv8yylu2alyg76y\t0.00000000\tnew\nm/84'/0'/2'/0/3     \tbc1qal3r040k26cw2f08337huzcf00hrnws5rhfrz3\t0.00000000\tnew\nm/84'/0'/2'/0/4     \tbc1qpv4nm7wwtxesgwsr0g0slxls33u0w02gqx2euk\t0.00000000\tnew\nm/84'/0'/2'/0/5     \tbc1qk3ekjzlvw3uythw738z7nvwe2sg93w2rtuy6ml\t0.00000000\tnew\nBalance:\t0.00000000\ninternal addresses\tm/84'/0'/2'/1\t\nBalance:\t0.00000000\nBalance for mixdepth 2:\t0.00000000\nmixdepth\t3\txpub6CMAJ67vZWVY3uty61M6jeGheGU5ni5mQmqMW2QLQbEa8ZQXuBw1K2umKFZsmU8EMEafJZKQkGS1trtWE5dtz4XmDbvLvUccAPn26ZC5i2o\nexternal addresses\tm/84'/0'/3'/0\txpub6EvT4QFPRdkt2sji3QdLLZjkJQmk7G2y3umT99ceomKTXGYvZ5S9TLaGos6cEugXEuxS6s9kvSUj1Xvpiu65dn5yzK7CgdZLzXawpKC9Mpe\nm/84'/0'/3'/0/0     \tbc1q9ph5l2gknjezcmzv84rnhu4df566jgputzef7l\t0.00000000\tnew\nm/84'/0'/3'/0/1     \tbc1qrlvmmxfuryr3mfhssjv45h0fl6s43g3vzrkwca\t0.00000000\tnew\nm/84'/0'/3'/0/2     \tbc1q40xkajgv9q42ve92zstwjc9v4jgauxme9su6uc\t0.00000000\tnew\nm/84'/0'/3'/0/3     \tbc1q38pfk8yfnu97v4mckkuk2dhk9u8geuyzu9c0hc\t0.00000000\tnew\nm/84'/0'/3'/0/4     \tbc1q2qzxyw56em9qdxc5z5s5xjz3j6s2qlzn3juvtu\t0.00000000\tnew\nm/84'/0'/3'/0/5     \tbc1qd2f8f3dau5pfjqu7dpuvt6fahj36w4rgl3xevr\t0.00000000\tnew\nBalance:\t0.00000000\ninternal addresses\tm/84'/0'/3'/1\t\nBalance:\t0.00000000\nBalance for mixdepth 3:\t0.00000000\nmixdepth\t4\txpub6CMAJ67vZWVY7gT4oJQBMc1fhbausT57yNVLCLCMwaGed5spHKaQY1EMQxvL2vTgDfhEimuAy7bzBE1qx5uY6D7cpUjQtXPHpyJzFuUtQPN\nexternal addresses\tm/84'/0'/4'/0\txpub6EQWpKsBTG3N9TFU4v6WtCcBJuLAeTZTcUwVJTxYUAsHeVPFdey4qT1dg4G7MqvnFFgHZDxqTo37S81UWUA2BqKKoTff1pcHTcSFzxyp5JG\nm/84'/0'/4'/0/0     \tbc1qdpjh3ewm367jm5eazqdf8wfrm09py50wn47urs\t0.00000000\tnew\nm/84'/0'/4'/0/1     \tbc1q2x0fmtms5nr3wz3x3660c8wampg7t22e6m30t8\t0.00000000\tnew\nm/84'/0'/4'/0/2     \tbc1q23595yg3dkj8gd3jrgup0hyzslhzf9skrg50r5\t0.00000000\tnew\nm/84'/0'/4'/0/3     \tbc1qw48asjpkwm3k2w8cketqhrre0uwq9f7ypwzmxl\t0.00000000\tnew\nm/84'/0'/4'/0/4     \tbc1qf3wljw44utyv7qd0z57zvdkfl20y470mva0nes\t0.00000000\tnew\nm/84'/0'/4'/0/5     \tbc1qz3f80rtv0ux85d7rc06ldtvmpqyfx6ly48c9pa\t0.00000000\tnew\nBalance:\t0.00000000\ninternal addresses\tm/84'/0'/4'/1\t\nBalance:\t0.00000000\nBalance for mixdepth 4:\t0.00000000\nTotal balance:\t0.00000000\n\n")])])])])}),[],!1,null,null,null);t.default=o.exports}}]);